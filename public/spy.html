<!DOCTYPE html>
<html>
    <head>
        <title>Controller Page</title>

        <Script src = "https://aframe.io/releases/1.0.3/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.x/dist/aframe-look-at-component.min.js"></script> 
        <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="js/direction-collider.js"></script>
        <script src="js/safe-controller.js"></script>
        <script src="js/door-controller.js"></script>
    </head>
    <body>
        <a-scene shadow="type: pcfsoft">
            <a-assets timeout="10000">
                <a-asset-item id="monster_model"   response-type="arraybuffer" src="models/monster.glb"></a-asset-item>
                <a-asset-item id="facility_model"   response-type="arraybuffer" src="models/facility2.glb"></a-asset-item>
                <a-asset-item id="safe_model"   response-type="arraybuffer" src="models/safe.glb"></a-asset-item>
                <a-asset-item id="door_model"   response-type="arraybuffer" src="models/door.glb"></a-asset-item>
            </a-assets>

            <!-- Camera -->
            <a-entity id = "cam_rig" position = "0 1.8 0">
                <a-camera id = "cam_object" class = "cam_class" look-controls position = "0 0 0" far="1000000000">  
                    <a-entity light="type:point; color:green; intensity:1.8; castShadow: true; shadowCameraNear: 0.1; shadowCameraLeft: -1; shadowCameraBottom: -1;shadowCameraRight: 1;shadowCameraTop: 1; shadowCameraFov: 90.11; shadowRadius: 4.640; distance:10;" position="0 0 0.9" ></a-entity>
                    <a-entity   cursor="rayOrigin:mouse;"
                            raycaster="far:30; interval:100; objects:.clickable;">
                        
                    </a-entity>
                    <a-entity   class="targetDir"
                                position="0 0 -1">
                    </a-entity>     
                    <a-entity id="directionVec" direction-collider="" raycaster="far:0.5; near: 0.001; interval:10; objects:.facility">
                        
                    </a-entity>  

                </a-camera>        
            </a-entity>

            <!-- Safe -->
            <a-entity   id = "safe_object"
                class = "facility"
                position = "2 1.5 -15"
                rotation = "0 180 0"
                scale = "1 1 1"
                shadow="cast: true; receive: true;"
                gltf-model = "#safe_model"
                animation-mixer="clip: Idle; loop: repeat"
                safe-controller="">
                <a-entity light="type:point; color:yellow; intensity:1.8; distance:10; castShadow: true; shadowCameraNear: 0.1; shadowCameraLeft: -1; shadowCameraBottom: -1;shadowCameraRight: 1;shadowCameraTop: 1; shadowCameraFov: 90.11; shadowRadius: 4.640; distance:10;" position="0 0 4" ></a-entity>
            </a-entity>

            <!-- Door -->
            <a-entity   id = "door_click"
                class = "clickable"
                position = "10 1.5 -8"
                rotation = "0 0 0"
                scale = "1 1 1"
                geometry="primitive: box; width: 2; height: 2; depth: 0.5;"
                material="opacity:0;transparent:true; blending:additive;alphaTest:1"
                door-controller="">
                <a-entity   id = "door_object"
                    class = "facility"
                    position = "0 0 0"
                    rotation = "0 0 0"
                    scale = "1 1 1"
                    shadow="cast: true; receive: true;"
                    gltf-model = "#door_model"
                    animation-mixer="">
                </a-entity>
            </a-entity>

            <!-- Poor little monster-->
            <a-entity   id = "monster_boi"
                position = "-1.3 1 3.2"
                rotation = "0 0 0"
                scale = "0.5 0.5 0.5"
                gltf-model = "#monster_model">
            </a-entity>

            <!-- The Facility, most dynamic stuff will be separate -->
            <a-entity   id = "facility_boi"
                class = "facility"
                position = "0 1.5 0"
                rotation = "0 0 0"
                scale = "1 1 1"
                shadow="cast: true; receive: true;"
                gltf-model = "#facility_model"
                material = "dithering: false">
            </a-entity>

            <!-- Hallway Clue TextBox -->
            <a-entity   id = "text_base"
                geometry="shape:box; width:0.2; height:0.1; depth:0.1"
                position = "9 1.5 -4"
                rotation = "0 90 0"
                material = "dithering: false; color:black">

                <a-entity   id = "text"
                    class = "text"
                    text = "value: 921; align:center; color:#333333;"
                    position = "0 0 0.06"
                    rotation = "0 0 0"
                    scale = "1 1 1"
                    material = "dithering: false; color:black; opacity:0.3">
                </a-entity>
            </a-entity>

            <!-- LaserRoom Clue TextBox -->
            <a-entity   id = "text_base"
                geometry="shape:box; width:0.2; height:0.1; depth:0.1"
                position = "12 1.5 -12"
                rotation = "0 225 0"
                material = "dithering: false; color:black">

                <a-entity   id = "text"
                    class = "text"
                    text = "value: 476; align:center; color:#333333;"
                    position = "0 0 0.06"
                    rotation = "0 0 0"
                    scale = "1 1 1"
                    material = "dithering: false; color:black; opacity:0.3">
                </a-entity>
            </a-entity>

            <a-entity id = "laser_beams">
                <a-entity id = "laser_collider"
                    class = "facility"
                    position = "9 1.5 -15"
                    rotation = "0 0 0"
                    scale = "1 1 1"
                    geometry="primitive: box; width: 8; height: 4; depth: 2;"
                    material="opacity:0;transparent:true; blending:additive;alphaTest:1">
                </a-entity>

                <!-- Laser Beam -->
                <a-entity id = "laser_beam"
                        position = "13 1.5 -16"
                        rotation = "0 0 0"
                        scale = "9 0.06 0.06"
                        animation="property: rotation; from: 0 0 -9; to: 0 0 9; loop: true; dur: 900; easing: easeInOutCubic; dir: alternate;">
                    <a-entity   id = "laser_beam"
                        position = "-0.5 0 0"
                        rotation = "0 0 0"
                        scale = "1 1 1"
                        geometry="primitive: box; width: 1; height: 1; depth: 1;"
                        material="color: red; blending: additive; emissive: #F00; opacity: 0.7;">
                        <a-entity light="type:point; color:red; intensity:1.8; castShadow: true; shadowCameraNear: 0.1; shadowCameraLeft: -1; shadowCameraBottom: -1;shadowCameraRight: 1;shadowCameraTop: 1; shadowCameraFov: 90.11; shadowRadius: 4.640; distance:10;" position="0 0 0" ></a-entity>
                    </a-entity>
                </a-entity>

                <!-- Laser Beam 2 -->
                <a-entity id = "laser_beam"
                        position = "5 1.7 -15"
                        rotation = "0 0 0"
                        scale = "9 0.06 0.06"
                        animation="property: rotation; from: 0 180 -9; to: 0 180 9; loop: true; dur: 800; easing: easeInOutCubic; dir: alternate;">
                    <a-entity   id = "laser_beam"
                        position = "-0.5 0 0"
                        rotation = "0 0 0"
                        scale = "1 1 1"
                        geometry="primitive: box; width: 1; height: 1; depth: 1;"
                        material="color: red; blending: additive; emissive: #F00; opacity: 0.7;">
                    </a-entity>
                </a-entity>

                <!-- Laser Beam 3 -->
                <a-entity id = "laser_beam"
                        position = "5 1.2 -14"
                        rotation = "0 0 0"
                        scale = "9 0.06 0.06"
                        animation="property: rotation; from: 0 180 -9; to: 0 180 9; loop: true; dur: 1000; easing: easeInOutCubic; dir: alternate;">
                    <a-entity   id = "laser_beam"
                        position = "-0.5 0 0"
                        rotation = "0 0 0"
                        scale = "1 1 1"
                        geometry="primitive: box; width: 1; height: 1; depth: 1;"
                        material="color: red; blending: additive; emissive: #F00; opacity: 0.7;">
                    </a-entity>
                </a-entity>

                <!-- Laser Beam 4 -->
                <a-entity id = "laser_beam"
                        position = "13 1.1 -14.5"
                        rotation = "0 0 0"
                        scale = "9 0.06 0.06"
                        animation="property: rotation; from: 0 0 -9; to: 0 0 9; loop: true; dur: 1300; easing: easeInOutCubic; dir: alternate;">
                    <a-entity   id = "laser_beam"
                        position = "-0.5 0 0"
                        rotation = "0 0 0"
                        scale = "1 1 1"
                        geometry="primitive: box; width: 1; height: 1; depth: 1;"
                        material="color: red; blending: additive; emissive: #F00; opacity: 0.7;">
                    </a-entity>
                </a-entity>
            </a-entity>

        </a-scene>

        <!--
        <h1>SPY</h1>
        
        <script>
            let socket = io();
            socket.on('connect', function(){
                console.log("I am connected - " + socket.id);
            });

            document.querySelector('').addEventListener('click',function(){
                console.log('Red button clicked');
                socket.emit('red_event');
            });
        </script>
        -->
    </body>
</html>